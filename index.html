<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Drone Camera Settings Field Tool</title>
  <meta name="theme-color" content="#0b0d10" />

  <style>
    :root{
      --bg:#0b0d10;
      --fg:#e9eef5;
      --muted:#9aa7b6;
      --card:rgba(255,255,255,0.07);
      --card2:rgba(255,255,255,0.05);
      --border:rgba(255,255,255,0.12);
      --accent:#7dd3fc;
      --ok:#86efac;
      --warn:#fde68a;
      --bad:#fca5a5;
      --shadow: 0 14px 40px rgba(0,0,0,.55);
      --radius: 18px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Inter, Helvetica, Arial, sans-serif;
      background:
        radial-gradient(1100px 700px at 20% -10%, rgba(125,211,252,.10), transparent 55%),
        radial-gradient(900px 700px at 90% 10%, rgba(134,239,172,.08), transparent 60%),
        radial-gradient(900px 700px at 50% 120%, rgba(253,230,138,.06), transparent 60%),
        var(--bg);
      color: var(--fg);
    }

    .wrap{
      max-width: 760px;
      margin: 0 auto;
      padding: 18px 14px 28px;
    }

    header{
      display:flex;
      align-items:flex-start;
      gap:12px;
      margin: 6px 0 14px;
    }

    .badge{
      width:44px; height:44px;
      border-radius: 14px;
      background: rgba(125,211,252,.12);
      border: 1px solid rgba(125,211,252,.20);
      display:grid;
      place-items:center;
      flex: 0 0 auto;
    }
    .badge svg{ opacity:.95 }

    h1{
      font-size: 18px;
      margin:0;
      line-height: 1.2;
      letter-spacing: .2px;
    }
    .sub{
      margin:4px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .row{
      display:grid;
      grid-template-columns: 1fr;
      gap: 8px;
    }

    label{
      font-size: 12px;
      color: var(--muted);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }

    select, button, input[type="text"]{
      width:100%;
      appearance:none;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      color: var(--fg);
      padding: 12px 12px;
      font-size: 15px;
      outline: none;
    }

    select:disabled{
      opacity: .55;
    }

    .hint{
      font-size: 12px;
      color: var(--muted);
      margin-top: 6px;
      line-height: 1.35;
    }

    .toggles{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }

    .toggle{
      background: var(--card2);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      min-height: 48px;
    }
    .toggle .t-title{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .toggle .t-title span:first-child{
      font-size: 13px;
      color: var(--fg);
    }
    .toggle .t-title span:last-child{
      font-size: 11px;
      color: var(--muted);
    }

    .switch{
      position:relative;
      width: 44px;
      height: 26px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.07);
      flex: 0 0 auto;
    }
    .switch input{
      opacity:0;
      width:0; height:0;
      position:absolute;
    }
    .knob{
      position:absolute;
      top: 3px; left: 3px;
      width: 20px; height: 20px;
      border-radius: 999px;
      background: rgba(233,238,245,.92);
      transition: transform .18s ease;
    }
    .switch input:checked + .knob{
      transform: translateX(18px);
      background: rgba(134,239,172,.95);
    }

    .actions{
      display:flex;
      gap: 10px;
      margin-top: 12px;
    }
    .btn{
      cursor:pointer;
      border: 1px solid rgba(125,211,252,.30);
      background: rgba(125,211,252,.14);
      font-weight: 600;
    }
    .btn.secondary{
      border-color: var(--border);
      background: rgba(255,255,255,0.06);
      font-weight: 600;
    }
    .btn:active{ transform: translateY(1px); }

    .result{
      margin-top: 12px;
      padding: 14px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: rgba(0,0,0,.22);
    }

    .result h2{
      margin:0 0 10px;
      font-size: 15px;
      letter-spacing: .2px;
    }

    .chips{
      display:flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }
    .chip{
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      color: var(--fg);
    }
    .chip.ok{ border-color: rgba(134,239,172,.35); background: rgba(134,239,172,.12); }
    .chip.warn{ border-color: rgba(253,230,138,.35); background: rgba(253,230,138,.10); }
    .chip.bad{ border-color: rgba(252,165,165,.35); background: rgba(252,165,165,.10); }

    .kv{
      display:grid;
      grid-template-columns: 1fr;
      gap: 8px;
    }
    .kv .line{
      display:flex;
      justify-content:space-between;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.08);
    }
    .k{
      color: var(--muted);
      font-size: 13px;
    }
    .v{
      font-size: 14px;
      font-weight: 650;
      text-align:right;
    }

    .notes{
      margin-top: 10px;
      font-size: 13px;
      line-height: 1.45;
      color: var(--muted);
    }

    .small{
      font-size: 12px;
      color: var(--muted);
      margin-top: 8px;
      line-height: 1.35;
    }

    @media (min-width: 720px){
      h1{ font-size: 20px; }
      .grid{ grid-template-columns: 1fr 1fr; }
      .row.full{ grid-column: 1 / -1; }
      .kv{ grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="badge" aria-hidden="true">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
          <path d="M12 2l7 4v6c0 5-3.5 9-7 10-3.5-1-7-5-7-10V6l7-4z" stroke="rgba(233,238,245,.92)" stroke-width="1.6"/>
          <path d="M8.6 12.2l2.1 2.1 4.6-4.8" stroke="rgba(134,239,172,.95)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div>
        <h1>Drone Camera Settings, Field Cheat Tool</h1>
        <p class="sub">Pick the drone, lighting and what you’re doing, it’ll spit out sensible starting settings (video and photo) plus an ND suggestion.</p>
      </div>
    </header>

    <div class="card">
      <div class="grid">
        <div class="row">
          <label for="drone">Drone</label>
          <select id="drone">
            <option value="">Select…</option>
            <option value="mini1">Mavic Mini Mk1</option>
            <option value="neo2">Neo Mk2</option>
            <option value="mini3p">Mini 3 Pro</option>
            <option value="mini5p">Mini 5 Pro</option>
            <option value="m4dt">Matrice 4DT</option>
          </select>
          <div id="droneHint" class="hint"></div>
        </div>

        <div class="row">
          <label for="mode">Output</label>
          <select id="mode" disabled>
            <option value="">Select…</option>
            <option value="video">Video</option>
            <option value="photo">Photo</option>
            <option value="both">Both</option>
          </select>
          <div class="hint">If you pick “Both”, you’ll get a video preset and a photo preset.</div>
        </div>

        <div class="row">
          <label for="lighting">Lighting</label>
          <select id="lighting" disabled>
            <option value="">Select…</option>
            <option value="bright">Bright sun / snow glare</option>
            <option value="mixed">Sun + clouds (changeable)</option>
            <option value="overcast">Overcast</option>
            <option value="golden">Golden hour</option>
            <option value="dusk">Dusk / low light</option>
            <option value="night">Night (street lights etc.)</option>
          </select>
        </div>

        <div class="row">
          <label for="mission">Mission style</label>
          <select id="mission" disabled>
            <option value="">Select…</option>
            <option value="cinematic">Cinematic (slow, smooth)</option>
            <option value="trackingSlow">Tracking subject (walking, gentle follow)</option>
            <option value="trackingFast">Tracking subject (cars, fast movement)</option>
            <option value="actionCrisp">Action crisp (short shutter, less blur)</option>
            <option value="landscapePhoto">Landscape / stills</option>
            <option value="nightVideo">Night video (accept limitations)</option>
          </select>
        </div>

        <div class="row full">
          <div class="toggles">
            <div class="toggle" title="PAL prefers 25/50 fps, NTSC prefers 30/60 fps.">
              <div class="t-title">
                <span>PAL mode</span>
                <span>25/50 base fps</span>
              </div>
              <label class="switch" aria-label="PAL mode">
                <input id="palToggle" type="checkbox" checked />
                <span class="knob"></span>
              </label>
            </div>

            <div class="toggle" title="Lock white balance for video to avoid colour shifts mid-clip.">
              <div class="t-title">
                <span>Lock white balance</span>
                <span>recommended for video</span>
              </div>
              <label class="switch" aria-label="Lock white balance">
                <input id="wbToggle" type="checkbox" checked />
                <span class="knob"></span>
              </label>
            </div>

            <div class="toggle" title="Use D-Log M / D-Cinelike if the drone supports it, otherwise normal.">
              <div class="t-title">
                <span>Use flat profile</span>
                <span>if available</span>
              </div>
              <label class="switch" aria-label="Use flat profile">
                <input id="flatToggle" type="checkbox" checked />
                <span class="knob"></span>
              </label>
            </div>

            <div class="toggle" title="If on, we will favour keeping ISO down and suggest ND more aggressively for video.">
              <div class="t-title">
                <span>Prioritise low ISO</span>
                <span>cleaner image</span>
              </div>
              <label class="switch" aria-label="Prioritise low ISO">
                <input id="isoToggle" type="checkbox" checked />
                <span class="knob"></span>
              </label>
            </div>
          </div>
        </div>
      </div>

      <div class="actions">
        <button id="resetBtn" class="btn secondary" type="button">Reset</button>
        <button id="copyBtn" class="btn" type="button" disabled>Copy result</button>
      </div>

      <div id="result" class="result" style="display:none;">
        <h2>Recommended starting settings</h2>
        <div id="chips" class="chips"></div>
        <div class="kv" id="kv"></div>
        <div class="notes" id="notes"></div>
        <div class="small" id="specs"></div>
      </div>

      <div class="small">
        Notes: This is a “get it right quickly” tool, not a religion. If you want crisp action, break the 180° shutter rule on purpose.
      </div>
    </div>
  </div>

  <script>
    // ------------------------------------------------------------
    // Drone spec notes (from DJI official support/spec pages where possible)
    // Keep these as "guidance", not gospel.
    // ------------------------------------------------------------
    const DRONES = {
      mini1: {
        name: "Mavic Mini Mk1",
        sensor: "1/2.3\" CMOS, 12MP",
        aperture: "f/2.8 (fixed)",
        log: "No (normal profile)",
        maxVideo: "2.7K 25/30, 1080p up to 60",
        nd: "Aftermarket only",
        notes: "Great for daylight, keep ISO low. 2.7K is your quality ceiling.",
        photoRaw: "No RAW (JPEG only on Mk1 in DJI Fly)",
        wbTip: "Lock WB for video to avoid pulsing colour."
      },
      neo2: {
        name: "Neo Mk2",
        sensor: "1/2\" CMOS, 12MP",
        aperture: "f/2.2 (fixed)",
        log: "Unknown/limited (treat as normal profile)",
        maxVideo: "4K up to 60",
        nd: "Aftermarket available",
        notes: "Small drone, small sensor, it’s a daylight/social tool. Don’t chase miracles at night.",
        photoRaw: "Likely JPEG (check your app options)",
        wbTip: "Lock WB if you can, Neo-style cameras can drift on Auto."
      },
      mini3p: {
        name: "Mini 3 Pro",
        sensor: "1/1.3\" CMOS",
        aperture: "f/1.7 (fixed)",
        log: "D-Cinelike (yes), D-Log (no)",
        maxVideo: "4K up to 60",
        nd: "Aftermarket / third-party",
        notes: "Very capable. f/1.7 means you’ll want ND fast in daylight if using 180° shutter.",
        photoRaw: "RAW supported (DNG)",
        wbTip: "Lock WB for clean grading, especially in D-Cinelike."
      },
      mini5p: {
        name: "Mini 5 Pro",
        sensor: "1\" CMOS, 50MP",
        aperture: "f/1.8 (fixed)",
        log: "D-Log M / HLG (per DJI specs)",
        maxVideo: "Up to 4K (high fps supported)",
        nd: "DJI Fly More ND kit (assumed available)",
        notes: "Big sensor for a mini, still benefits from ND to keep motion natural.",
        photoRaw: "RAW supported",
        wbTip: "Lock WB, shoot flat if you’ll grade."
      },
      m4dt: {
        name: "Matrice 4DT",
        sensor: "Multi-camera payload (wide + tele variants)",
        aperture: "Depends on camera (some very wide apertures)",
        log: "Enterprise profiles vary",
        maxVideo: "Depends on camera",
        nd: "Typically no consumer ND workflow, expose carefully",
        notes: "Treat as an ops platform. For ‘pretty’ footage, keep it conservative and stable.",
        photoRaw: "Depends on capture mode",
        wbTip: "Lock WB if you’re producing client-facing video clips."
      }
    };

    // ------------------------------------------------------------
    // UI elements
    // ------------------------------------------------------------
    const elDrone = document.getElementById("drone");
    const elMode = document.getElementById("mode");
    const elLighting = document.getElementById("lighting");
    const elMission = document.getElementById("mission");
    const elDroneHint = document.getElementById("droneHint");

    const palToggle = document.getElementById("palToggle");
    const wbToggle = document.getElementById("wbToggle");
    const flatToggle = document.getElementById("flatToggle");
    const isoToggle = document.getElementById("isoToggle");

    const result = document.getElementById("result");
    const chips = document.getElementById("chips");
    const kv = document.getElementById("kv");
    const notes = document.getElementById("notes");
    const specs = document.getElementById("specs");

    const resetBtn = document.getElementById("resetBtn");
    const copyBtn = document.getElementById("copyBtn");

    // ------------------------------------------------------------
    // Helpers
    // ------------------------------------------------------------
    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

    function roundShutter(target){
      // Round to common shutter values used on DJI
      const common = [30,40,50,60,80,100,120,160,200,240,250,320,400,500,640,800,1000,1600,2000,3200,4000,8000];
      // target is denominator (e.g. 50 -> 1/50)
      let best = common[0];
      let bestDiff = Math.abs(common[0] - target);
      for (const v of common){
        const d = Math.abs(v - target);
        if (d < bestDiff){ best = v; bestDiff = d; }
      }
      return best;
    }

    function baseFps(){
      // PAL: 25/50. NTSC: 30/60.
      return palToggle.checked ? 25 : 30;
    }

    function fmtShutter(den){ return `1/${den}`; }

    function chip(text, kind){
      const div = document.createElement("div");
      div.className = `chip ${kind || ""}`.trim();
      div.textContent = text;
      return div;
    }

    function line(k, v){
      const div = document.createElement("div");
      div.className = "line";
      div.innerHTML = `<div class="k">${k}</div><div class="v">${v}</div>`;
      return div;
    }

    function supportsFlatProfile(droneKey){
      const log = (DRONES[droneKey]?.log || "").toLowerCase();
      return log.includes("d-log") || log.includes("d-cinelike") || log.includes("hlg");
    }

    function pickProfile(droneKey){
      if (!flatToggle.checked) return "Normal";
      if (!supportsFlatProfile(droneKey)) return "Normal";
      // Prefer D-Log M if available, else D-Cinelike, else HLG.
      const log = DRONES[droneKey].log || "";
      if (log.includes("D-Log M") || log.toLowerCase().includes("d-log m")) return "D-Log M";
      if (log.toLowerCase().includes("d-cinelike")) return "D-Cinelike";
      if (log.toLowerCase().includes("hlg")) return "HLG";
      return "Normal";
    }

    function wbSuggestion(lighting){
      if (!wbToggle.checked) return "Auto (not recommended for video)";
      // Rough Kelvin starting points
      switch(lighting){
        case "bright": return "Lock WB ~5600K (sunny)";
        case "mixed": return "Lock WB ~5600–6000K (pick one and stick to it)";
        case "overcast": return "Lock WB ~6500K (cloudy)";
        case "golden": return "Lock WB ~4500–5200K (golden hour)";
        case "dusk": return "Lock WB ~4200–5200K (tweak to taste)";
        case "night": return "Lock WB ~3200–4200K (street lights vary)";
        default: return "Lock white balance";
      }
    }

    function ndSuggestion(lighting, mission, droneKey){
      // Simple, field-usable ND table. Assumes fixed aperture and 180° shutter in daylight.
      // If user picks crisp action (short shutter), ND may be reduced.
      const hasConsumerNDKit = (droneKey === "mini5p");
      const wantsCrisp = (mission === "actionCrisp");
      const wantsNight = (lighting === "night" || lighting === "dusk");

      if (wantsNight) return "No ND (remove filters, keep light)";

      let nd;
      switch(lighting){
        case "bright":
          nd = wantsCrisp ? "ND16–ND32" : "ND32–ND64";
          break;
        case "mixed":
          nd = wantsCrisp ? "ND8–ND16" : "ND16–ND32";
          break;
        case "overcast":
          nd = wantsCrisp ? "ND4–ND8" : "ND8–ND16";
          break;
        case "golden":
          nd = wantsCrisp ? "ND4" : "ND4–ND8";
          break;
        default:
          nd = "No ND";
      }

      if (hasConsumerNDKit){
        return `${nd} (from Fly More ND kit where possible)`;
      }
      return `${nd} (if you have one)`;
    }

    function isoSuggestion(lighting, mission, droneKey){
      // Conservative ISO guidance; small sensors suffer quickly.
      // Mini 5 Pro + Mini 3 Pro can tolerate a bit more, still keep it sensible.
      const biggishSensor = (droneKey === "mini3p" || droneKey === "mini5p");
      const night = (lighting === "night");
      const dusk = (lighting === "dusk");
      const overcast = (lighting === "overcast" || lighting === "mixed");
      const bright = (lighting === "bright" || lighting === "golden");

      if (bright) return "ISO 100 (cap 200 if Auto)";

      if (overcast){
        return biggishSensor ? "ISO 100–400" : "ISO 100–200 (try to stay low)";
      }

      if (dusk){
        return biggishSensor ? "ISO 400–800 (cap 800)" : "ISO 200–800 (cap 800, accept noise)";
      }

      if (night){
        return biggishSensor ? "ISO 800–1600 (cap 1600 if possible)" : "ISO 800+ (expect noise, keep motion slow)";
      }

      return "ISO 100–400";
    }

    function pickFps(mission, droneKey){
      const base = baseFps();

      // Basic intent:
      // - Cinematic / tracking slow / night: base fps (25 or 30)
      // - Tracking fast: double base (50 or 60) if likely available
      // - Crisp action: double base (50/60) or higher if available, but we won’t assume
      // - Landscape photo: n/a
      if (mission === "landscapePhoto") return null;

      if (mission === "trackingFast" || mission === "actionCrisp"){
        return base * 2; // 50/60
      }

      // For Neo 2 etc, base is fine.
      return base;
    }

    function shutterForMission(fps, mission){
      if (!fps) return null;

      // 180° shutter by default: 1/(2*fps)
      const cinematicDen = roundShutter(2 * fps);

      // If crisp action, shorten shutter: roughly 1/(4*fps) as a starting point
      if (mission === "actionCrisp"){
        const crispDen = roundShutter(4 * fps);
        return { den: crispDen, rule: "Crisp action (short shutter)" };
      }

      // Night video: keep 180° to preserve light, even accept blur
      if (mission === "nightVideo"){
        return { den: cinematicDen, rule: "Night (stick near 180° for light)" };
      }

      return { den: cinematicDen, rule: "180° rule (natural motion blur)" };
    }

    function exposureNotes(lighting, mission){
      const arr = [];
      if (lighting === "bright") arr.push("Watch highlights (snow/sky), use zebras/histogram if you’ve got them.");
      if (lighting === "mixed") arr.push("Set exposure for the subject, not the brightest cloud, re-check every few minutes.");
      if (lighting === "night") arr.push("Fly slower than feels natural, avoid fast yaw, it turns into mush quickly.");
      if (mission === "cinematic") arr.push("Use slow yaw, gentle stick curves, and keep gimbal movement lazy.");
      if (mission === "trackingFast") arr.push("Prioritise keeping the subject exposed, background can clip if needed.");
      if (mission === "actionCrisp") arr.push("Short shutter can look ‘staccato’, that’s the point.");
      return arr;
    }

    function photoPreset(lighting, droneKey){
      // Straightforward photo guidance.
      const raw = DRONES[droneKey]?.photoRaw || "Depends on model";
      const base = [];
      base.push(["Format", raw.includes("RAW") ? "RAW (DNG) if available" : "Highest quality available"]);
      base.push(["ISO", "ISO 100 (raise only if you must)"]);
      base.push(["WB", lighting === "night" ? "Try 3200–4200K" : "Daylight/Cloudy to match scene"]);
      base.push(["Mode", "Single + AEB (3–5 frames) for HDR scenes"]);
      base.push(["Focus", "Tap to focus, then lock if possible"]);
      base.push(["Tip", "If it’s windy, take multiple shots and pick the sharpest."]);
      return base;
    }

    function buildResult(){
      const droneKey = elDrone.value;
      const mode = elMode.value;
      const lighting = elLighting.value;
      const mission = elMission.value;

      if (!droneKey || !mode || !lighting || !mission) {
        result.style.display = "none";
        copyBtn.disabled = true;
        return;
      }

      const d = DRONES[droneKey];
      const profile = pickProfile(droneKey);

      // Build chips
      chips.innerHTML = "";
      chips.appendChild(chip(d.name, "ok"));
      chips.appendChild(chip(palToggle.checked ? "PAL 25/50" : "NTSC 30/60", "warn"));
      chips.appendChild(chip(profile, supportsFlatProfile(droneKey) ? "ok" : "warn"));
      if (wbToggle.checked) chips.appendChild(chip("WB locked", "ok"));
      else chips.appendChild(chip("WB auto", "warn"));

      kv.innerHTML = "";
      notes.innerHTML = "";
      specs.textContent = "";

      const noteLines = [];

      // VIDEO preset
      if (mode === "video" || mode === "both"){
        const fps = pickFps(mission, droneKey);
        const shutter = shutterForMission(fps, mission);
        const iso = isoSuggestion(lighting, mission, droneKey);
        const nd = ndSuggestion(lighting, mission, droneKey);
        const wb = wbSuggestion(lighting);

        kv.appendChild(line("Video profile", profile));
        kv.appendChild(line("Frame rate", fps ? `${fps} fps` : "n/a"));
        kv.appendChild(line("Shutter speed", shutter ? `${fmtShutter(shutter.den)} (${shutter.rule})` : "n/a"));
        kv.appendChild(line("ISO target", iso));
        kv.appendChild(line("ND filter", nd));
        kv.appendChild(line("White balance", wb));

        if (isoToggle.checked){
          noteLines.push("Low ISO priority: if exposure is off, fix it with ND and shutter (within reason) before you start cranking ISO.");
        }
      }

      // PHOTO preset
      if (mode === "photo" || mode === "both"){
        const photo = photoPreset(lighting, droneKey);
        for (const [k,v] of photo){
          kv.appendChild(line(`Photo: ${k}`, v));
        }
      }

      // Common notes
      const exp = exposureNotes(lighting, mission);
      for (const n of exp) noteLines.push(n);

      // Drone-specific notes
      if (d.notes) noteLines.push(d.notes);

      // Add a couple of consistent “field rules”
      noteLines.push("If you’re grading later, expose to protect highlights, you can lift shadows more safely than clipped sky.");
      noteLines.push("Do a 3-second test clip, check it, then commit. Saves you flying home with regret.");

      notes.innerHTML = "<ul style='margin:8px 0 0; padding-left: 18px;'>" +
        noteLines.map(x => `<li>${x}</li>`).join("") +
        "</ul>";

      specs.textContent =
        `Camera notes: ${d.sensor} • ${d.aperture} • Max video: ${d.maxVideo} • Flat profile: ${d.log} • ND: ${d.nd}`;

      result.style.display = "block";
      copyBtn.disabled = false;

      // Save state for next time (handy in the field)
      const state = {
        droneKey, mode, lighting, mission,
        pal: palToggle.checked, wb: wbToggle.checked,
        flat: flatToggle.checked, iso: isoToggle.checked
      };
      try{ localStorage.setItem("fieldToolState", JSON.stringify(state)); }catch(e){}
    }

    function setEnabled(){
      elMode.disabled = !elDrone.value;
      elLighting.disabled = !elMode.value;
      elMission.disabled = !elLighting.value;

      if (!elDrone.value){
        elDroneHint.textContent = "";
      } else {
        const d = DRONES[elDrone.value];
        elDroneHint.textContent = `${d.sensor}, ${d.aperture}.`;
      }
    }

    function resetAll(){
      elDrone.value = "";
      elMode.value = "";
      elLighting.value = "";
      elMission.value = "";
      palToggle.checked = true;
      wbToggle.checked = true;
      flatToggle.checked = true;
      isoToggle.checked = true;

      setEnabled();
      buildResult();

      try{ localStorage.removeItem("fieldToolState"); }catch(e){}
    }

    function loadState(){
      try{
        const raw = localStorage.getItem("fieldToolState");
        if (!raw) return;
        const s = JSON.parse(raw);
        if (s.droneKey) elDrone.value = s.droneKey;
        setEnabled();
        if (s.mode) elMode.value = s.mode;
        setEnabled();
        if (s.lighting) elLighting.value = s.lighting;
        setEnabled();
        if (s.mission) elMission.value = s.mission;

        if (typeof s.pal === "boolean") palToggle.checked = s.pal;
        if (typeof s.wb === "boolean") wbToggle.checked = s.wb;
        if (typeof s.flat === "boolean") flatToggle.checked = s.flat;
        if (typeof s.iso === "boolean") isoToggle.checked = s.iso;

        buildResult();
      }catch(e){}
    }

    function copyResult(){
      const droneKey = elDrone.value;
      const mode = elMode.value;
      const lighting = elLighting.value;
      const mission = elMission.value;
      const d = DRONES[droneKey];
      const profile = pickProfile(droneKey);

      const parts = [];
      parts.push(`Drone: ${d.name}`);
      parts.push(`Output: ${mode}`);
      parts.push(`Lighting: ${elLighting.options[elLighting.selectedIndex].text}`);
      parts.push(`Mission: ${elMission.options[elMission.selectedIndex].text}`);
      parts.push(`System: ${palToggle.checked ? "PAL (25/50)" : "NTSC (30/60)"}`);
      parts.push(`Profile: ${profile}`);
      parts.push(`WB: ${wbSuggestion(lighting)}`);
      if (mode === "video" || mode === "both"){
        const fps = pickFps(mission, droneKey);
        const sh = shutterForMission(fps, mission);
        parts.push(`FPS: ${fps} fps`);
        parts.push(`Shutter: ${fmtShutter(sh.den)} (${sh.rule})`);
        parts.push(`ISO: ${isoSuggestion(lighting, mission, droneKey)}`);
        parts.push(`ND: ${ndSuggestion(lighting, mission, droneKey)}`);
      }
      if (mode === "photo" || mode === "both"){
        parts.push(`Photo: ISO 100, RAW if available, AEB for HDR scenes`);
      }

      const text = parts.join("\n");
      navigator.clipboard.writeText(text).then(() => {
        copyBtn.textContent = "Copied";
        setTimeout(() => copyBtn.textContent = "Copy result", 900);
      }).catch(() => {
        alert("Couldn’t copy (browser blocked). You can long-press and select text in the result area instead.");
      });
    }

    // ------------------------------------------------------------
    // Events
    // ------------------------------------------------------------
    elDrone.addEventListener("change", () => {
      setEnabled();
      // Clear downstream selections for sanity
      elMode.value = "";
      elLighting.value = "";
      elMission.value = "";
      setEnabled();
      buildResult();
    });

    elMode.addEventListener("change", () => {
      elLighting.value = "";
      elMission.value = "";
      setEnabled();
      buildResult();
    });

    elLighting.addEventListener("change", () => {
      elMission.value = "";
      setEnabled();
      buildResult();
    });

    elMission.addEventListener("change", buildResult);

    [palToggle, wbToggle, flatToggle, isoToggle].forEach(t => t.addEventListener("change", buildResult));

    resetBtn.addEventListener("click", resetAll);
    copyBtn.addEventListener("click", copyResult);

    // Initial enable state + load saved state
    setEnabled();
    loadState();
  </script>
</body>
</html>
